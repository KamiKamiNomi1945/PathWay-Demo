<!doctype html>
<html lang="da">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>AR Demo</title>
  <script type="module" src="https://unpkg.com/@google/model-viewer@3.3.0/dist/model-viewer.min.js"></script>
  <style>
    html,body { margin:0; height:100%; }
    body { display:grid; grid-template-rows:auto 1fr auto; font-family:system-ui, sans-serif; }
    header,footer { padding:12px 16px; }
    #wrap { display:grid; place-items:center; background:#111; }
    model-viewer { width:50%; height:100%; background:#111; }
    .hint { font-size:13px; opacity:.8 }
    .bar { display:flex; gap:8px; align-items:center; flex-wrap:wrap }
    input[type="text"] { width:min(480px, 90vw); }
  </style>
</head>
<body>
  <header class="bar">
    <strong>AR Demo</strong>
    <span class="hint">Tip: På Android/Chrome trykker du “View in your space”.</span>
  </header>

  <div id="wrap">
    <!-- Standard-model. Skiftes automatisk hvis ?model=... findes -->
    <model-viewer id="mv"
      src="https://modelviewer.dev/shared-assets/models/Astronaut.glb"
      ios-src="https://modelviewer.dev/shared-assets/models/Astronaut.usdz"
      ar ar-modes="webxr scene-viewer quick-look"
      ar-placement="floor" ar-scale="fixed"
      camera-controls auto-rotate
      exposure="1" environment-image="neutral"
      poster="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='1280' height='720'%3E%3Crect width='100%25' height='100%25' fill='%23111'/%3E%3Ctext x='50%25' y='50%25' fill='%23aaa' font-size='32' text-anchor='middle' dominant-baseline='middle'%3EIndl%C3%A6ser model...%3C/text%3E%3C/svg%3E">
      <!-- model-viewer indsætter selv en AR-knap -->
    </model-viewer>
  </div>

  <footer class="bar">
    <label class="hint">Indlæs en anden model (GLB URL):</label>
    <input id="url" type="text" placeholder="https://.../din-model.glb" />
    <button id="load">Indlæs</button>
    <button id="makeLink">Lav delbar link</button>
    <span id="status" class="hint"></span>
  </footer>

  <script type="module">
    const mv = document.getElementById('mv');
    const url = document.getElementById('url');
    const status = document.getElementById('status');

    // Hvis siden åbnes som .../index.html?model=https://.../fil.glb
    const q = new URLSearchParams(location.search);
    const m = q.get('model');
    const u = q.get('usdz'); // valgfri iOS-fil
    if (m) mv.src = m;
    if (u) mv.setAttribute('ios-src', u);

    // Knap: Indlæs direkte fra tekstfelt
    document.getElementById('load').addEventListener('click', () => {
      if (!url.value.trim()) return;
      mv.src = url.value.trim();
      status.textContent = 'Indlæser...';
    });

    // Knap: Lav et link du kan sætte i QR-koden
    document.getElementById('makeLink').addEventListener('click', () => {
      const base = location.origin + location.pathname;
      const link = `${base}?model=${encodeURIComponent(mv.src)}`;
      navigator.clipboard.writeText(link).then(() => {
        status.textContent = 'Link kopieret! Indsæt det i din QR-kode.';
      });
    });

    mv.addEventListener('load', () => status.textContent = 'Model klar ✔︎');
    mv.addEventListener('error', (e) => status.textContent = 'Kunne ikke indlæse modellen (tjek URL/HTTPS/CORS).');
  </script>
</body>
</html>